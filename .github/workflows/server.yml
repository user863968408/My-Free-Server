name: Public Cloud Server with Cloudflare Tunnel
on:
  workflow_dispatch:  # 手动触发
  schedule:
    - cron: '0 0 * * *'  # 可选：定时触发

jobs:
  server:
    runs-on: ubuntu-latest
    timeout-minutes: 350  # 接近6小时上限
    steps:
      - name: Install dependencies
        run: |
          sudo apt update
          sudo apt install -y openssh-server nginx  # 安装SSH和Web服务器
          
      - name: Configure SSH
        run: |
          echo "root:your_password" | sudo chpasswd
          sudo sed -i 's/^#PermitRootLogin.*/PermitRootLogin yes/' /etc/ssh/sshd_config
          sudo service ssh start
          
      - name: Setup Cloudflare Tunnel
        uses: AnimMouse/setup-cloudflared@v2  # 安装cloudflared{insert\_element\_4\_}
      
      - name: Start Cloudflare Tunnel
        run: |
          cloudflared tunnel --no-autoupdate run --token ${{ secrets.CLOUDFLARE_TUNNEL_TOKEN }}
